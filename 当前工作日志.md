## 2026-01-06

### âœ… ä¿®å¤ Bot ç¾¤èŠè§¦å‘é€»è¾‘

- **æ—¶é—´**: 2026-01-06 01:10
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **é—®é¢˜ä¿®å¤**: ä¿®å¤äº† Bot åœ¨ç¾¤èŠä¸­ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰è½¬å‘æ¶ˆæ¯ï¼ˆåŒ…æ‹¬éæ–‡æœ¬æ¶ˆæ¯å¦‚å›¾ç‰‡ï¼‰å¹¶æŠ¥é”™ "âš ï¸ æš‚ä¸æ”¯æŒè½¬å‘éæ–‡æœ¬æ¶ˆæ¯" çš„é—®é¢˜ã€‚
  - **é€»è¾‘è°ƒæ•´**:
    - **ç¾¤èŠ**: å¿½ç•¥æ‰€æœ‰è½¬å‘æ¶ˆæ¯ï¼Œé™¤éæ˜¾å¼ Mention æˆ–å›å¤ Botï¼ˆç¬¦åˆ PRD S1/S2ï¼‰ã€‚
    - **ç§èŠ**: ä¿æŒè‡ªåŠ¨å¤„ç†è½¬å‘æ¶ˆæ¯çš„åŠŸèƒ½ï¼ˆStory S7ï¼‰ã€‚
  - **åŠŸèƒ½å¢å¼º**: åœ¨**ç§èŠ**ä¸­æ”¯æŒè½¬å‘å¸¦æ ‡é¢˜ (Caption) çš„å›¾ç‰‡/è§†é¢‘ï¼ŒBot ä¼šæå–æ ‡é¢˜ä½œä¸ºä»»åŠ¡å†…å®¹ã€‚
  - **å•å…ƒæµ‹è¯•**: æ–°å¢ `server/internal/server/http/handlers/telegram/webhook_logic_test.go` éªŒè¯è½¬å‘é€»è¾‘æ¡ä»¶ã€‚
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (Verified)
- **ä¿®æ”¹æ–‡ä»¶**:
  - `server/internal/server/http/handlers/telegram/webhook.go`
  - `server/internal/server/http/handlers/telegram/webhook_logic_test.go` (æ–°å»º)

### âœ… æ—¥å†è®¢é˜…åŠŸèƒ½ (Calendar Sync)

- **æ—¶é—´**: 2026-01-06 01:35
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **åŠŸèƒ½å®ç°**: å®ç°äº† Webcal æ—¥å†è®¢é˜…åŠŸèƒ½ï¼Œç”¨æˆ·å¯åœ¨ç³»ç»Ÿæ—¥å†ä¸­è‡ªåŠ¨åŒæ­¥å¾…åŠä»»åŠ¡ã€‚
  - **æ•°æ®åº“**: æ–°å¢ `calendar_token` å­—æ®µåˆ° `users` è¡¨ã€‚
  - **åç«¯**: æ–°å¢ `GET /cal/:token/todo.ics` è¿”å› ICS æ ¼å¼æ—¥å†ï¼Œ`POST /api/me/calendar-token` ç”Ÿæˆè®¢é˜…é“¾æ¥ã€‚
  - **å‰ç«¯**: Settings é¡µé¢æ–°å¢ã€Œæ—¥å†åŒæ­¥ã€æ¨¡å—ï¼Œä¸€é”®å¯ç”¨è®¢é˜…ã€‚
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (Build Verified)
- **ä¿®æ”¹æ–‡ä»¶**:
  - `server/migrations/sql/000009_add_calendar_token.up.sql` (æ–°å»º)
  - `server/internal/models/user.go`
  - `server/internal/repository/user_repository.go`
  - `server/internal/server/http/handlers/calendar/handler.go` (æ–°å»º)
  - `server/internal/config/config.go`
  - `server/cmd/api/main.go`
  - `web/src/api/user.ts`
  - `web/src/pages/SettingsPage.vue`

### âœ… CI ä¿®å¤ä¸æµ‹è¯• Mock è¡¥å…¨

- **æ—¶é—´**: 2026-01-06 02:35
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **Mock ä¿®å¤**: è§£å†³äº†å›  UserRepository æ¥å£æ–°å¢ `FindByCalendarToken` æ–¹æ³•å¯¼è‡´çš„å¤šä¸ªæµ‹è¯•åŒ…ç¼–è¯‘å¤±è´¥é—®é¢˜ã€‚
  - **æ¶µç›–æ¨¡å—**:
    - `server/internal/server/http/handlers/auth`
    - `server/internal/service/notion`
    - `server/internal/service/task`
  - **éªŒè¯**: æœ¬åœ°è¿è¡Œ `go test ./server/...` å…¨éƒ¨é€šè¿‡ã€‚
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (Fix Committed)
- **ä¿®æ”¹æ–‡ä»¶**:
  - `server/internal/server/http/handlers/auth/handler_test.go`
  - `server/internal/service/notion/service_test.go`
  - `server/internal/service/task/creator_test.go`

### âœ… HomePage Header æˆªæ–­ä¿®å¤

- **æ—¶é—´**: 2026-01-06 03:12
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **é—®é¢˜**: ç”¨æˆ·åé¦ˆ HomePage ä¸Šæ»‘æ—¶ï¼Œåˆ†ç»„ Tab æ ï¼ˆ"è‡ªå·±åˆ›å»º"ç­‰ï¼‰è¢«æˆªæ–­ä¸€åŠã€‚
  - **åŸå› **: Header é«˜åº¦æ˜¯å›ºå®šçš„ï¼Œä½†å½“æ˜¾ç¤º "åˆ†ç»„å¯¼èˆªæ¡" (Anchor Chips) æ—¶ï¼Œå†…å®¹é«˜åº¦å¢åŠ å¯¼è‡´æº¢å‡ºã€‚
  - **ä¿®å¤**: åœ¨ `HomePage.vue` ä¸­å®ç°åŠ¨æ€é«˜åº¦è®¡ç®—ã€‚å½“å­˜åœ¨å¤šä¸ªåˆ†ç»„æ—¶ï¼Œè‡ªåŠ¨å¢åŠ  48px Header é«˜åº¦ã€‚
  - **æ•ˆæœ**: ç¡®ä¿åœ¨ä»»ä½•çŠ¶æ€ä¸‹ï¼ˆæ”¶ç¼©/å±•å¼€ï¼‰ï¼Œæ‰€æœ‰å¯¼èˆªå…ƒç´ å‡å®Œæ•´å¯è§ã€‚
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (Deployed)
- **ä¿®æ”¹æ–‡ä»¶**:
  - `web/src/pages/HomePage.vue`

## 2025-12-28

### âœ… Bot ç¾¤èŠäº¤äº’ä¼˜åŒ– (Bot Interaction)

- **æ—¶é—´**: 2025-12-28 00:30
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **Inline Mode åˆ›å»ºä»»åŠ¡**: æ”¯æŒé€šè¿‡ Inline Query (`@Bot <text>`) ç›´æ¥å±•ç¤º "åˆ›å»ºä»»åŠ¡" é€‰é¡¹ï¼Œç‚¹å‡»åå‘é€ `/todo <text>` æŒ‡ä»¤ã€‚
  - **Bot æåŠè¿‡æ»¤**: ä¼˜åŒ–ç¾¤èŠæ¶ˆæ¯å¤„ç†é€»è¾‘ã€‚å½“ç”¨æˆ·å‘é€ `@Bot MyTask` æ—¶ï¼Œè‡ªåŠ¨å‰¥ç¦» Bot ç”¨æˆ·åï¼Œé˜²æ­¢ä»»åŠ¡æ ‡é¢˜åŒ…å« Bot åå­—æˆ– Bot è¢«é”™è¯¯æŒ‡æ´¾ä¸ºè´Ÿè´£äººã€‚
  - **å•å…ƒæµ‹è¯•**: æ–°å¢ regex é€»è¾‘çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–å¤šç§æåŠåœºæ™¯ï¼ˆå¼€å¤´ã€ç»“å°¾ã€ä¸­é—´ã€å¿½ç•¥å¤§å°å†™ç­‰ï¼‰ã€‚
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (Verified)
- **ä¿®æ”¹æ–‡ä»¶**:
  - `server/internal/server/http/handlers/telegram/webhook.go`
  - `server/internal/server/http/handlers/telegram/webhook_custom_test.go` (New Test)

## 2025-12-27

### âœ… é¦–é¡µä»»åŠ¡åˆ—è¡¨é‡æ„ (Home Page Refactor)

- **æ—¶é—´**: 2025-12-27 19:00
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **äº¤äº’é‡æ„**: ç§»é™¤åˆ†ç»„æŠ˜å åŠŸèƒ½ï¼Œæ”¹ä¸ºé»˜è®¤å±•å¼€ï¼›å»é™¤ Sticky Header çš„å¸é¡¶æ•ˆæœï¼Œæ”¹ä¸ºè‡ªç„¶æ»šåŠ¨ã€‚
  - **æ ·å¼ä¼˜åŒ–**:
    - **Solid Header**: å¼ºåˆ¶é¡¶éƒ¨å¯¼èˆªæ ä¸ºçº¯è‰²ä¸é€æ˜èƒŒæ™¯ï¼Œè§£å†³æ»šåŠ¨æ—¶å†…å®¹é€æ˜å åŠ çš„è§†è§‰é—®é¢˜ã€‚
    - **Header Layout**: å°† Anchor Chips (å¿«é€Ÿå®šä½é”šç‚¹) ç§»è‡³é¡¶éƒ¨å›ºå®šåŒºåŸŸï¼Œä¸å†éšåˆ—è¡¨æ»šåŠ¨ã€‚
    - **Alignment**: è¿™æ˜¯ä¸€ä¸ªåƒç´ çº§å¯¹é½ä¼˜åŒ–ï¼Œå°†åˆ†ç»„æ ‡é¢˜å·¦å†…è¾¹è·è°ƒæ•´ä¸º 32pxï¼Œä¸ä»»åŠ¡å¡ç‰‡æ–‡å­—å‚ç›´å¯¹é½ã€‚
    - **Tab Logic**: å®ç°äº† "æŒ‡æ´¾ç»™æˆ‘"ã€"æˆ‘åˆ›å»ºçš„"ã€"å·²å®Œæˆ" ä¸‰ä¸ªç‹¬ç«‹ Tabï¼Œæ”¯æŒæœåŠ¡ç«¯è®¡æ•°ä¸çŠ¶æ€è¿‡æ»¤ã€‚
  - **Bug ä¿®å¤**: ä¿®å¤äº† Header é«˜åº¦è¿‡å¤§å¯¼è‡´å¸ƒå±€é”™ä¹±çš„é—®é¢˜ï¼›ä¿®å¤äº† Sticky Header é®æŒ¡å†…å®¹çš„é—®é¢˜ã€‚
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (Deployed)
- **ä¿®æ”¹æ–‡ä»¶**:
  - `web/src/pages/HomePage.vue`
  - `web/src/styles/main.css` (Cleanup)
  - `server/internal/repository/task.go` (ListByUser Sorting)

### ğŸ’¡ éœ€æ±‚æ•è·: AI è¾…åŠ©ä¸Šä¸‹æ–‡åˆ†æ

- **æ—¶é—´**: 2025-12-27 14:18
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - æ•è·æ–°éœ€æ±‚ï¼šåˆ©ç”¨ AI åˆ†æç¾¤èŠä¸Šä¸‹æ–‡ï¼ˆå‰ 10 æ¡æ¶ˆæ¯ï¼‰ã€‚
  - åŠŸèƒ½ç‚¹ï¼š
    1. **æ™ºèƒ½å®šçº§**: è‡ªåŠ¨æ¨æ–­ High/Medium/Lowã€‚
    2. **æ™ºèƒ½æ¦‚è¿°**: ç”Ÿæˆæ‘˜è¦å¹¶è¿½åŠ åˆ° Descriptionã€‚
  - äº¤äº’æ¨¡å¼ï¼šé™é»˜ã€å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ç”¨æˆ·ä¸»æµç¨‹ã€‚
  - äº§å‡ºæ–‡æ¡£ï¼š`docs/backlog/20251227_ai_context_analysis.md`
- **çŠ¶æ€**: âœ… å·²å½’æ¡£ (Backlog)

## 2025-12-24

### âœ… UI æ€§èƒ½ä¼˜åŒ–ä¸äº¤äº’å‡çº§

- **æ—¶é—´**: 2025-12-24 19:50
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - **æ€§èƒ½ä¼˜åŒ– (Fix Detail Page Lag)**: ä¿®å¤è¯¦æƒ…é¡µè¿›å…¥æ—¶çš„å¡é¡¿é—®é¢˜ã€‚é‡‡ç”¨**åˆ†æ­¥æ¸²æŸ“ (Staged Loading)** ç­–ç•¥ï¼Œä¼˜å…ˆæ¸²æŸ“æ ¸å¿ƒå†…å®¹ï¼Œå»¶è¿Ÿæ¸²æŸ“è¯„è®ºä¸æè¿°ï¼Œå¤§å¹…æå‡ TTI (Time to Interactive)ã€‚
  - **iOS é£æ ¼è¿‡æ¸¡ (Motion)**: åºŸå¼ƒæ¸å˜è¿‡æ¸¡ï¼Œå®ç° iOS åŸç”Ÿé£æ ¼çš„ä¾§æ»‘è¿‡æ¸¡ (Slide Over) ä¸è§†å·®æ•ˆæœ (`translate3d`)ï¼Œç§»é™¤ `mode="out-in"` ä»¥æ”¯æŒå¹¶è¡Œä¸æ‰‹åŠ¿æ“ä½œã€‚
  - **äº¤äº’ä¿®å¤ (Scroll Interaction)**:
    - ä¿®å¤äº†å› ç»å¯¹å®šä½å¯¼è‡´çš„é¦–é¡µé¡¶éƒ¨æ æ— æ³•è‡ªåŠ¨æŠ˜å é—®é¢˜ï¼ˆæ”¹ä¸ºç›‘å¬å®¹å™¨æ»šåŠ¨ï¼‰ã€‚
    - ä¿®å¤äº† FAB (åˆ›å»ºæŒ‰é’®) éšé¡µé¢æ»šåŠ¨çš„é—®é¢˜ï¼ˆå°† FAB ç§»å‡ºæ»šåŠ¨å®¹å™¨ï¼‰ã€‚
  - **ä½“éªŒå¾®è°ƒ**:
    - ç¦ç”¨å¯åŠ¨é¡µ (Onboarding) çš„è¿›å…¥åŠ¨ç”»ï¼Œé¿å…è¿å’Œæ„Ÿã€‚
    - è¯¦æƒ…é¡µæè¿°ç¼–è¾‘æ¡†æ”¯æŒè‡ªåŠ¨é«˜åº¦è°ƒæ•´ã€‚
- **ä¿®æ”¹æ–‡ä»¶**:
  - `web/src/App.vue`: å…¨å±€è¿‡æ¸¡é€»è¾‘ã€å¸ƒå±€ç»“æ„ã€‚
  - `web/src/pages/HomePage.vue`: æ»šåŠ¨ç›‘å¬ã€FAB å®šä½ã€‚
  - `web/src/pages/TaskDetailPage.vue`: åˆ†æ­¥åŠ è½½é€»è¾‘ã€éª¨æ¶å±ã€‚
  - `web/src/styles/main.css`: iOS åŠ¨ç”»æ ·å¼ã€‚

### ğŸ› Bug ä¿®å¤

- âœ… **Story S1/S2 Â· ç¾¤èŠä»»åŠ¡åˆ›å»ºè§¦å‘é€»è¾‘**

  - ä¿®å¤äº† Bot åœ¨ç¾¤èŠä¸­æ— æ³•å“åº” `@Bot + æ–‡æœ¬` æ¶ˆæ¯çš„é—®é¢˜
  - åŸé€»è¾‘è¦æ±‚å¿…é¡»æ˜¯å›å¤æ¶ˆæ¯æ‰è§¦å‘ä»»åŠ¡åˆ›å»ºï¼Œä¸ç¬¦åˆ PRD è¦æ±‚
  - æ–°å¢ `shouldCreateTask()` å‡½æ•°ï¼Œæ­£ç¡®åˆ¤æ–­ä»¥ä¸‹åœºæ™¯ï¼š
    - ç¾¤èŠä¸­ `@Bot + æ–‡æœ¬` â†’ åˆ›å»ºä»»åŠ¡
    - ç¾¤èŠä¸­ `Reply + @Bot` â†’ åˆ›å»ºä»»åŠ¡
  - ä¿®æ”¹æ–‡ä»¶ï¼š`server/internal/server/http/handlers/telegram/webhook.go`

- âœ… **æ•°æ®åº“ Schema Â· group_id ç±»å‹ä¸åŒ¹é…**

  - ä¿®å¤äº† `tasks.group_id` ç±»å‹é”™è¯¯å¯¼è‡´çš„ä»»åŠ¡åˆ›å»ºå¤±è´¥
  - é—®é¢˜ï¼š`groups.id` æ˜¯ TEXTï¼ˆå­˜å‚¨ Telegram Chat IDï¼‰ï¼Œä½† `tasks.group_id` å®šä¹‰ä¸º UUID
  - è§£å†³æ–¹æ¡ˆï¼š
    - åˆ›å»ºè¿ç§» `000006_fix_group_id_type.up.sql` å°† `tasks.group_id` æ”¹ä¸º TEXT
    - æ›´æ–° `repository/task.go` ä¸­çš„ GORM ç±»å‹æ ‡ç­¾
  - ä¿®æ”¹æ–‡ä»¶ï¼š
    - `server/migrations/sql/000006_fix_group_id_type.up.sql` (æ–°å¢)
    - `server/migrations/sql/000006_fix_group_id_type.down.sql` (æ–°å¢)
    - `server/internal/repository/task.go`

- âœ… **ç”¨æˆ·ä½“éªŒä¼˜åŒ– Â· ç¾¤èŠäº¤äº’å¼•å¯¼**

  - ä¼˜åŒ– Bot å…¥ç¾¤æ¬¢è¿æ¶ˆæ¯ï¼Œæä¾›è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
  - ä¼˜åŒ–ä»»åŠ¡åˆ›å»ºæˆåŠŸåçš„å›å¤ï¼Œæ˜¾ç¤ºæ›´å¤šæœ‰ç”¨ä¿¡æ¯
  - æ”¹è¿›å†…å®¹ï¼š
    - å…¥ç¾¤æ¬¢è¿ï¼šè¯¦ç»†è¯´æ˜å¦‚ä½•åˆ›å»ºä»»åŠ¡ã€ç»‘å®š Notionï¼Œå¹¶æä¾›ç»‘å®šæŒ‰é’®
    - ä»»åŠ¡åˆ›å»ºå›å¤ï¼šæ˜¾ç¤ºæŒ‡æ´¾äººæ•°ã€åŒæ­¥çŠ¶æ€ï¼Œæä¾›æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…æŒ‰é’®
  - ä¿®æ”¹æ–‡ä»¶ï¼š`server/internal/server/http/handlers/telegram/webhook.go`

- âœ… **Bug ä¿®å¤ Â· Telegram æŒ‰é’®ç±»å‹é”™è¯¯**

  - ä¿®å¤äº† `BUTTON_TYPE_INVALID` é”™è¯¯å¯¼è‡´çš„ç¾¤èŠæ— å“åº”é—®é¢˜
  - é—®é¢˜ï¼šå½“ `webAppURL` æœªé…ç½®æ—¶ï¼Œ`buildWebAppMarkup` è¿”å› nilï¼Œä½†ä»£ç ä»å°è¯•å‘é€å¯¼è‡´ API æŠ¥é”™
  - è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ markup æ˜¯å¦ä¸º nilï¼Œæœªé…ç½®æ—¶æä¾›å‘½ä»¤è¡ŒæŒ‡å¼•è€Œä¸å‘é€æŒ‰é’®
  - ä¿®æ”¹æ–‡ä»¶ï¼š`server/internal/server/http/handlers/telegram/webhook.go`

- âœ… **äº§å“ç­–ç•¥è°ƒæ•´ Â· å¼±åŒ– Notion åŠŸèƒ½å¼ºè°ƒ**
  - æ ¹æ®äº§å“å®šä½è°ƒæ•´æ¶ˆæ¯æ–‡æ¡ˆï¼Œå¼ºè°ƒæœ¬åœ°ä»»åŠ¡ç®¡ç†ä¸ºæ ¸å¿ƒåŠŸèƒ½
  - Notion åŒæ­¥å®šä½ä¸º"é”¦ä¸Šæ·»èŠ±"çš„å¯é€‰å¢å¼ºåŠŸèƒ½
  - æ”¹è¿›å†…å®¹ï¼š
    - å…¥ç¾¤æ¬¢è¿ï¼šç§»é™¤ Notion è¯¦ç»†è¯´æ˜ï¼Œæ”¹ä¸º"é«˜çº§è®¾ç½®"æŒ‰é’®
    - ä»»åŠ¡åˆ›å»ºå›å¤ï¼šç§»é™¤ Notion æåŠï¼Œä»…åœ¨å·²åŒæ­¥æ—¶æ˜¾ç¤º"âœ“ å·²åŒæ­¥"
  - ä¿®æ”¹æ–‡ä»¶ï¼š`server/internal/server/http/handlers/telegram/webhook.go`

---

# å½“å‰å·¥ä½œæ—¥å¿—

## 2025-12-22

## 2025-12-23

### âœ… æ·»åŠ å‰ç«¯æƒé™ä¸è¶³æç¤º

- **æ—¶é—´**: 2025-12-23 22:52
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - åœ¨ä»»åŠ¡è¯¦æƒ…é¡µé¢çš„ä¿®æ”¹æ“ä½œä¸­æ·»åŠ  403 é”™è¯¯æ£€æŸ¥
  - ä¿®æ”¹ `cycleStatus`ã€`updateDueDate`ã€`clearDueDate` å‡½æ•°
  - å½“ç”¨æˆ·æ²¡æœ‰æƒé™æ—¶ï¼Œæ˜¾ç¤ºæç¤ºï¼š"æƒé™ä¸è¶³ï¼šæ‚¨æ²¡æœ‰æƒé™ä¿®æ”¹æ­¤ä»»åŠ¡ã€‚åªæœ‰åˆ›å»ºäººã€æŒ‡æ´¾äººæˆ–ç¾¤ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹ä»»åŠ¡ã€‚"
  - ä¿®å¤ TypeScript ç±»å‹é”™è¯¯ï¼ˆåœ¨ `PatchTaskRequest` ä¸­æ·»åŠ  `due_at` å­—æ®µï¼‰
- **ä¿®æ”¹æ–‡ä»¶**:
  - `web/src/pages/TaskDetailPage.vue`
  - `web/src/api/task.ts`

## 2025-12-22

### âœ… å®ç°ä»»åŠ¡ä¿®æ”¹æƒé™æ§åˆ¶

- **æ—¶é—´**: 2025-12-22 19:45
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - åˆ›å»ºæƒé™æ ¡éªŒå‡½æ•° `CanModifyTask`ï¼ˆæ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºåˆ›å»ºäººã€æŒ‡æ´¾äººæˆ–ç¾¤ç®¡ç†å‘˜ï¼‰
  - åˆ›å»º UserGroup Repository å®ç°ç”¨æˆ·ç¾¤ç»„å…³ç³»æŸ¥è¯¢
  - åœ¨ä»»åŠ¡æ›´æ–° API (`PATCH /tasks/:task_id`) ä¸­æ·»åŠ æƒé™æ ¡éªŒ
  - åœ¨ä»»åŠ¡åˆ é™¤ API (`DELETE /tasks/:task_id`) ä¸­æ·»åŠ æƒé™æ ¡éªŒ
  - æ— æƒé™æ—¶è¿”å› 403 Forbidden é”™è¯¯ï¼Œæç¤º"æ‚¨æ²¡æœ‰æƒé™ä¿®æ”¹/åˆ é™¤æ­¤ä»»åŠ¡"
- **æƒé™è§„åˆ™**: åªæœ‰ç¾¤ Adminã€åˆ›å»ºäººã€æŒ‡æ´¾äººå¯ä»¥ä¿®æ”¹ä»»åŠ¡ï¼Œå…¶ä»–äººåªèƒ½æŸ¥çœ‹å’Œè¯„è®º
- **ä¿®æ”¹æ–‡ä»¶**:
  - `server/internal/service/task/permission.go` (æ–°å»º)
  - `server/internal/repository/user_group_repository.go` (æ–°å»º)
  - `server/internal/server/http/handlers/task/handler.go`
  - `server/cmd/api/main.go`
- **ä¸‹ä¸€æ­¥**: ç”¨æˆ·æµ‹è¯•æƒé™åŠŸèƒ½

### âœ… æ”¹ç”¨ Telegram æ·±é“¾æ¥æ ¼å¼

- **æ—¶é—´**: 2025-12-22 19:32
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - å°†ä»»åŠ¡é“¾æ¥ä» WebApp URL æ ¼å¼æ”¹ä¸º Telegram æ·±é“¾æ¥æ ¼å¼
  - æ—§æ ¼å¼ï¼š`https://ddddapp.zcvyzest.xyz?tg_web_app_start_param=task_xxx`
  - æ–°æ ¼å¼ï¼š`https://t.me/tg2no_test_bot?startapp=task_xxx`
  - ç¬¦åˆ Telegram Mini App å®˜æ–¹æ¨èçš„ startapp æ·±åº¦é“¾æ¥æ ‡å‡†
- **ä¿®æ”¹æ–‡ä»¶**: `server/internal/server/http/handlers/telegram/webhook.go`

### âœ… Bot ç¾¤èŠå›å¤æ–‡æ¡ˆä¼˜åŒ–å®Œæˆ

- **æ—¶é—´**: 2025-12-22 19:30
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - ç§»é™¤äº† Notion ç›¸å…³æç¤º
  - æ·»åŠ äº†ä»»åŠ¡é¡µ URLï¼ˆMini App é“¾æ¥ï¼‰
  - å½“æœ‰æŒ‡æ´¾äººæ—¶ï¼Œä¼š @ å¯¹åº”ç”¨æˆ·å¹¶æç¤º"è¯·ç‚¹å‡»é“¾æ¥æŸ¥æ”¶ä»»åŠ¡"
  - ä¼˜åŒ–äº†ä¸åŒåœºæ™¯ä¸‹çš„æ–‡æ¡ˆå±•ç¤º
- **ä¿®æ”¹æ–‡ä»¶**: `server/internal/server/http/handlers/telegram/webhook.go`

### âœ… ä¿®å¤ç¾¤èŠ WebApp æŒ‰é’®é”™è¯¯

- **æ—¶é—´**: 2025-12-22 19:25
- **è´Ÿè´£äºº**: AI Agent
- **é—®é¢˜**: Bot åœ¨ç¾¤èŠä¸­å›å¤æ—¶å‡ºç° `BUTTON_TYPE_INVALID` é”™è¯¯
- **æ ¹æœ¬åŸå› **: Telegram Bot API ä¸æ”¯æŒåœ¨ç¾¤èŠä¸­ä½¿ç”¨ `web_app` ç±»å‹çš„æŒ‰é’®ï¼Œåªèƒ½åœ¨ç§èŠä¸­ä½¿ç”¨
- **è§£å†³æ–¹æ¡ˆ**:
  - åœ¨ç¾¤èŠä¸­ä¸ä½¿ç”¨ WebApp æŒ‰é’®ï¼Œæ”¹ä¸ºå‘é€çº¯æ–‡æœ¬æ¶ˆæ¯
  - åœ¨ç§èŠä¸­å¯ä»¥æ­£å¸¸ä½¿ç”¨ WebApp æŒ‰é’®
- **ä¿®æ”¹æ–‡ä»¶**: `server/internal/server/http/handlers/telegram/webhook.go`, `server/internal/service/telegram/client.go`

### âœ… Telegram Webhook é…ç½®å®Œæˆ

- **æ—¶é—´**: 2025-12-22 19:16
- **è´Ÿè´£äºº**: AI Agent
- **å†…å®¹**:
  - æˆåŠŸè®¾ç½® Telegram Webhook URL ä¸º `https://ddddapi.zcvyzest.xyz/webhook/telegram`
  - ä¿®æ­£äº†åˆå§‹é…ç½®é”™è¯¯ï¼ˆä» `/api/webhook/telegram` æ”¹ä¸º `/webhook/telegram`ï¼‰
  - é‡æ–°æ„å»ºå¹¶éƒ¨ç½²åç«¯æœåŠ¡ï¼ŒåŒ…å«æ‰€æœ‰ Bug ä¿®å¤ï¼ˆç¾¤èŠä»»åŠ¡åˆ›å»ºã€æ•°æ®åº“ç±»å‹ã€æŒ‰é’®é”™è¯¯ï¼‰
  - éªŒè¯é€šè¿‡ï¼šå¾…å¤„ç†æ¶ˆæ¯æ•°ä¸º 0ï¼Œæ— é”™è¯¯
  - ç¯å¢ƒå˜é‡ `TELEGRAM_WEBHOOK_URL` å·²æ›´æ–°åˆ° `server/.env`
- **ä¸‹ä¸€æ­¥**: åœ¨ Telegram ç¾¤èŠä¸­æµ‹è¯•ä»»åŠ¡åˆ›å»ºåŠŸèƒ½

## 2025-12-10 Â· Database-First Roadmap Refinement

### å½“å‰çŠ¶æ€

- **UI Migration**: `âœ… å·²å®Œæˆ` (Home, Detail, Settings, Onboarding å‡å·²å¤åˆ» Prototype æ ·å¼)ã€‚
- **API Integration**: `ğŸ”„ è¿›è¡Œä¸­` (Task Detail è¯»å–å·²å®Œæˆ)ã€‚
- **Focus**: è½¬å‘ **æœ¬åœ°ä¼˜å…ˆ (Database-First)** ç­–ç•¥ï¼Œå¼±åŒ– Notion åŒæ­¥ã€‚

---

### â³ ç¨åå¼€å‘ (Backlog & Sync)

- [x] **Module 16 Â· Notionâ†’TG å›æµ**
  - Poller Service å·²å®ç° (Module 16)ï¼Œæ”¯æŒ Notion çŠ¶æ€å˜æ›´åŒæ­¥å› Telegramã€‚
- [x] **Story S8 Â· æŒ‰ Database ç­›é€‰è§†å›¾**
  - é¦–é¡µå·²æ”¯æŒ Database ç­›é€‰å™¨ï¼ŒAPI å·²æ”¯æŒ `database_id` è¿‡æ»¤ã€‚
- [x] **Story S9 Â· æ‰“å¼€ Notion æ·±åº¦ç¼–è¾‘**
  - ä»»åŠ¡è¯¦æƒ…é¡µå·²æ·»åŠ  "Open in Notion" æŒ‰é’®ã€‚
- [x] **Story O2 Â· Pending ä»»åŠ¡è¡¥å†™è‡³ Notion**
  - å®ç°äº† `SyncPendingTasksForUser`ï¼Œç»‘å®šç¾¤ç»„æ•°æ®åº“æ—¶è‡ªåŠ¨è§¦å‘å›æº¯åŒæ­¥ã€‚
- [x] **Story S3/N2 Â· Notion Update Sync**
  - `UpdatePage` implemented. TG Status/Title updates sync to Notion.
- [x] **Notion Deletion Sync & Retry**
  - Support Notion `Archived` sync -> Local Soft Delete.
- [x] **Notion Deletion Sync & Retry**
  - Support Notion `Archived` sync -> Local Soft Delete.
  - Implemented Retry (3x, exp backoff) for Notion API clients.
- [x] **Bot Reply Logic Optimization**
  - Added "Bind Notion" CTA button for tasks created in unbound groups.
  - Added "Configure Notion" CTA for forwarded tasks in private chat.

---

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨æŒ‡å— (Next Steps)

1.  âœ… **Module 15 / Story S5: Notion Sync Content**
    - Refactored `NotionClient` to support Block childrenã€‚
    - Updated `TaskCreator` to convert Description and Snapshots to Notion Blocks.
2.  âœ… **Story S8 & S9: Database Filter & Open in Notion**
    - S8: Implemented Database Filter Dropdown in HomePage.
    - S9: Added "Open in Notion" button in TaskDetail.

- âœ… 2025-12-10 [Story M1] è¿æ¥ç®¡ç†åˆ—è¡¨ï¼šå®Œæˆç¾¤ç»„åˆ—è¡¨é¡µå¼€å‘ï¼Œæ”¯æŒæŸ¥çœ‹ç»‘å®šçŠ¶æ€ä¸è§£ç»‘ã€‚
- âœ… 2025-12-10 [Story O2] å†å²å›æº¯ï¼šå®Œæˆä»»åŠ¡åŒæ­¥é€»è¾‘é‡æ„ï¼Œå®ç°ç»‘å®šæ•°æ®åº“æ—¶è‡ªåŠ¨åŒæ­¥å†å²ä»»åŠ¡ã€‚
- 2025-12-10 | âœ… | M16 | Notion Poller Service implemented (Backend). Syncs creation/updates.
- 2025-12-10 | âœ… | S8 | Database Filter on Home Page (Frontend done, Poller integration done).
- 2025-12-10 | âœ… | S3/N2 | Notion Update Sync (Task Status/Title updates sync to Notion).
- 2025-12-10 | âœ… | S3/N2 | Notion Update Sync (Task Status/Title updates sync to Notion).
- 2025-12-10 | âœ… | Task | Notion Deletion Sync (Soft Delete on Archived) & API Retry Mechanism.
- 2025-12-10 | âœ… | Refinement | Bot Reply Logic Optimized (Added Bind CTA buttons).

## ğŸ“ å¾…ç¡®è®¤äº‹é¡¹ / Pending Decisions

- Story O2: Retroactive Sync (è¿½æº¯åŒæ­¥) - å½“å‰ Poller ä»…åŒæ­¥æœ€è¿‘ 2 åˆ†é’Ÿçš„å˜æ›´ã€‚æ˜¯å¦éœ€è¦å…¨é‡åŒæ­¥ï¼Ÿ
- Poller å¼‚å¸¸å¤„ç† (Rate Limit) - å½“å‰ç®€å•è®°å½•æ—¥å¿—ï¼Œåç»­å¯èƒ½éœ€è¦é€€é¿ç­–ç•¥ã€‚

## ğŸ“… Next Steps

1.  Verify Poller in staging environment (User action).
2.  Refinement: Frontend Unbind / Re-bind improvements if needed.

### å·²å®Œæˆé‡Œç¨‹ç¢‘ (Completed Milestones)

#### 2025-12-10

- âœ… **Docs Â· éªŒæ”¶æ¸…å•æ‰©å……**ï¼šå¯¹ç…§ PRD V2.1 è¡¥å……äº† Story 0/G1~G4/S2/S3/S4/S8/N1/N3/O1/O2/U1/M1 ç­‰ç¼ºå¤±çš„éªŒæ”¶åœºæ™¯ï¼Œç¡®ä¿ QA è¦†ç›–å®Œæ•´ã€‚
- âœ… **Story S4/S6 (ä¸Šä¸‹æ–‡å¿«ç…§)**: å®ç°äº† Telegram æ¶ˆæ¯ä¸Šä¸‹æ–‡è‡ªåŠ¨æŠ“å–ã€æŒä¹…åŒ–åŠ Frontend Jump-to-Chat åŠŸèƒ½ã€‚
- âœ… [Antigravity] ä»»åŠ¡: æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å®Œæˆã€‚
  - **Context**: ç”¨æˆ·åé¦ˆ iPhone 14 Pro Max å‘çƒ«å¡é¡¿ã€‚
  - **Action**:
    - **Global CSS**: ç¦ç”¨ç§»åŠ¨ç«¯ `scan-line` åŠ¨ç”» (GPU æ¶ˆè€—å¤§æˆ·)ï¼›ç§»é™¤ç§»åŠ¨ç«¯é¡µé¢åˆ‡æ¢çš„ `blur` æ»¤é•œã€‚
    - **HomePage**: æ›¿æ¢ Header `backdrop-blur` ä¸ºçº¯è‰²é€æ˜åº¦ï¼›æ›¿æ¢ List Item `clip-path` ä¸ºåœ†è§’è¾¹æ¡† (å‡å°‘åˆæˆå±‚å‹åŠ›)ï¼›ä¼˜åŒ–é˜´å½±ã€‚
    - **Round 2 (Deep Opt)**: å½»åº•éšè—ç§»åŠ¨ç«¯ `.grid-bg` (èƒŒæ™¯æ¸å˜)ï¼›ç¦ç”¨ç§»åŠ¨ç«¯éª¨æ¶å± Shimmer åŠ¨ç”»ï¼›ä¸º Touch äº‹ä»¶æ·»åŠ  `passive` ä¿®é¥°ç¬¦ã€‚
  - **Files**: `web/src/styles/main.css`, `web/src/pages/HomePage.vue`.
  - **Fix**: ä¿®å¤ App.vue ä¸­è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ–¹å‘åå‘çš„é—®é¢˜ (`page-slide-left` vs `page-slide-right` é€»è¾‘äº’æ¢)ã€‚
  - **Fix**: ä¿®å¤ `TaskDetailPage` åº•éƒ¨è¯„è®ºæ¡†æœªå›ºå®šçš„é—®é¢˜ã€‚
    - **åŸå› **: çˆ¶çº§ `App.vue` çš„è¿‡æ¸¡åŠ¨ç”» wrapper è®¾ç½®äº† `will-change: transform`ï¼Œå¯¼è‡´å­å…ƒç´ çš„ `position: fixed` å¤±æ•ˆï¼ˆç›¸å¯¹äº wrapper è€Œé viewport å®šä½ï¼‰ï¼Œä¸” wrapper éš body æ»šåŠ¨ç§»å‡ºäº†å±å¹•ã€‚
    - **æ–¹æ¡ˆ**: é‡æ„è¯¦æƒ…é¡µä¸º Flexbox å¸ƒå±€ (`h-full flex-col`)ï¼ŒHeader/Footer å›ºå®šï¼Œä¸­é—´ Main åŒºåŸŸå†…éƒ¨æ»šåŠ¨ (`overflow-y-auto`)ã€‚
  - **Refactor**: é‡æ„ `TaskDetailPage` é¡¶éƒ¨åŠŸèƒ½åŒºä¸º **Grid Layout (å®«æ ¼å¸ƒå±€)**ã€‚
    - ä½¿ç”¨ 2 åˆ— Grid å±•ç¤º Status, Due Date, Assignee, Sourceã€‚
    - ç›¸æ¯”æ—§ç‰ˆï¼Œå¤§å¤§èŠ‚çœäº†å‚ç›´ç©ºé—´ï¼Œä¸”å¡ç‰‡å¼è®¾è®¡ç‚¹å‡»çƒ­åŒºæ›´æ˜ç¡®ã€‚
  - **Enhance**: ä¼˜åŒ–åŠŸèƒ½åŒºæ’åºä¸é€»è¾‘ã€‚
    - æ’åº: çŠ¶æ€/æˆªæ­¢æ—¥æœŸ -> è´Ÿè´£äºº/ä¼˜å…ˆçº§ -> åˆ›å»ºäºº/æ¥æºã€‚
    - åŠŸèƒ½: åˆ›å»ºäººç‚¹å‡»è·³è½¬å…¶ TG ä¼šè¯ï¼›ç§»é™¤å†—ä½™çš„"æŸ¥çœ‹å®Œæ•´è®°å½•"ã€‚
    - å­—æ®µ: åç«¯å·²è¡¥é½ `Creator` å…³è”æŸ¥è¯¢ã€‚
- âœ… **Module 18 (Native Assignment)**: ç”¨äºå®ç° Telegram åŸç”ŸæŒ‡æ´¾åŠŸèƒ½ã€‚
  - **Frontend**: `TaskDetailPage` æ–°å¢ç‚¹å‡»è´Ÿè´£äººè§¦å‘ `switchInlineQuery("assign <TaskID>")`ã€‚
  - **Backend**: `TelegramService` æ–°å¢ `HandleInlineQuery` å“åº”ä»»åŠ¡å¡ç‰‡ä¸ `HandleCallbackQuery` å¤„ç†æŒ‡æ´¾è®¤é¢†é€»è¾‘ã€‚
  - **Core**: `TaskRepository` ä¸ `TaskService` æ–°å¢ `AssignTask` æ–¹æ³•ã€‚
- âœ… **Module 16 (Notion Poller)**: å®ç°äº†åç«¯ Poller æœåŠ¡ï¼Œæ”¯æŒä» Notion åŒæ­¥çŠ¶æ€å˜æ›´åˆ° Telegram ä»»åŠ¡ (Notion -> TG Sync)ã€‚è§£å†³å¹¶ä¿®å¤äº†æ‰€æœ‰ç¼–è¯‘é”™è¯¯ä¸ Test Mocksã€‚
- âœ… **Module 15 / Story S5 (å†…å®¹åŒæ­¥)**: å®ç°äº† Notion Block æ˜ å°„ã€‚Task Description è½¬ä¸º Paragraphï¼ŒChat Context è½¬ä¸º Quote Blockï¼Œå¹¶é™„å¸¦ Callout æ ¼å¼çš„ Jump URLã€‚
- âœ… **Story S8 (Database Filter)**: ç¡®è®¤å‰åç«¯å·²æ”¯æŒ Database ç­›é€‰ã€‚
- âœ… **Story S9 (Open in Notion)**: ç¡®è®¤ä»»åŠ¡è¯¦æƒ…é¡µ"æ‰“å¼€ Notion"æŒ‰é’®å·²å®ç°ã€‚
- âœ… **Story O2 Â· Pending ä»»åŠ¡è¡¥å†™è‡³ Notion (Retroactive Sync)**
  - Implemented `SyncPendingTasks` in `TaskService`.
  - Trigger sync on Group Bind.
- âœ… **Story S3/N2 (Notion Update Sync)**: å®ç°äº† TG -> Notion çš„çŠ¶æ€ä¸æ ‡é¢˜æ›´æ–°åŒæ­¥ (UpdatePage)ã€‚

#### 2025-12-09

- âœ… **Story P1 (æ¯æ—¥æ‘˜è¦)**: é›†æˆ `robfig/cron`ï¼Œå®ç°æ¯æ—¥ 09:00 æ¨é€å¾…åŠæ±‡æ€»ã€‚
- âœ… **Story S7 (è½¬å‘åˆ›å»º)**: å®ç°äº† Telegram è½¬å‘æ¶ˆæ¯è‡ªåŠ¨è½¬æ¢ä¸ºä¸ªäººä»»åŠ¡ (Inbox)ã€‚
- âœ… **Story U1 (é»˜è®¤åº“)**: å®ç°äº† Settings é¡µé¢é€‰æ‹©é»˜è®¤ Notion Databaseï¼Œå¹¶ä¸ S7 è”åŠ¨ã€‚

#### 2025-12-08

- âœ… **UI Rewrite (Vue 3)**: å®Œæˆæ‰€æœ‰é¡µé¢ï¼ˆHome, Detail, Settingsï¼‰çš„ UI å¤åˆ»ä¸æš—è‰²æ¨¡å¼é€‚é…ã€‚

#### Prior

- âœ… **Module 14: Notification System** (2025-05-24)
