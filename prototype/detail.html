<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>任务详情 - 系统 V2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>

<body>
    <div class="grid-bg"></div>
    <div class="scan-line"></div>

    <div class="app-container">
        <header class="header">
            <div class="detail-header">
                <button id="backBtn" class="icon-btn tech-btn" style="border:none; width:auto; padding-right:10px;">
                    <i class="ri-arrow-left-line"></i> 返回
                </button>
                <!-- Top Actions Removed, moved to HUD -->
            </div>
        </header>

        <div class="task-list" style="padding-bottom: 220px;"> <!-- Extra padding for HUD -->

            <!-- Title (Moved to Top) -->
            <textarea class="detail-title-input" id="taskTitle" rows="1" style="margin-top: 0;">修复 iOS 登录 Bug</textarea>

            <!-- Context Snapshot -->
            <div class="context-snapshot-section" style="margin-top: 16px;">
                <div class="section-toggle" id="toggleContext">
                    <div class="toggle-left">
                        <i class="ri-chat-history-line"></i>
                        <span>上下文快照 (10条)</span>
                    </div>
                    <div class="toggle-right">
                        <a href="#" class="history-link">查看完整记录 <i class="ri-external-link-line"></i></a>
                        <i class="ri-arrow-down-s-line toggle-icon" style="transform: rotate(180deg);"></i>
                    </div>
                </div>
                <div class="context-content" id="contextContent">
                    <!-- Mock Chat Log (10 items) -->
                    <div class="chat-bubble other">
                        <div class="chat-name">Alice</div>
                        <div class="chat-text">iOS 端登录好像又挂了？</div>
                    </div>
                    <div class="chat-bubble me">
                        <div class="chat-text">我看下日志</div>
                    </div>
                    <div class="chat-bubble other">
                        <div class="chat-name">Bob</div>
                        <div class="chat-text">是 Token 过期的问题吗？</div>
                    </div>
                    <div class="chat-bubble me">
                        <div class="chat-text">看起来是 Refresh Token 没生效，我建个任务跟进下。</div>
                    </div>
                    <div class="chat-bubble other">
                        <div class="chat-name">Alice</div>
                        <div class="chat-text">刚才又有用户反馈了，错误码 401。</div>
                    </div>
                    <div class="chat-bubble me">
                        <div class="chat-text">收到，正在排查网关日志。</div>
                    </div>
                    <div class="chat-bubble other">
                        <div class="chat-name">Bob</div>
                        <div class="chat-text">是不是昨晚发布的版本有问题？</div>
                    </div>
                    <div class="chat-bubble me">
                        <div class="chat-text">有可能，我对比下 diff。</div>
                    </div>
                    <div class="chat-bubble other">
                        <div class="chat-name">Alice</div>
                        <div class="chat-text">辛苦，希望能尽快修复，客服那边压力有点大。</div>
                    </div>
                    <div class="chat-bubble me">
                        <div class="chat-text">放心，定位到问题马上修。</div>
                    </div>
                    <div class="chat-system">
                        <span>Bot created task via Reply</span>
                    </div>
                </div>
            </div>

            <!-- Description -->
            <div class="editor-content tech-border" contenteditable="true"
                style="padding: 16px; border-radius: 8px; margin-bottom: 24px; margin-top: 16px;">
                <p>用户反馈在 iOS 17.2 上无法完成登录流程，一直卡在 Loading 界面。</p>
                <p>初步排查是 Refresh Token 机制的问题。</p>
                <ul>
                    <li>检查网络请求日志</li>
                    <li>验证 Token 刷新逻辑</li>
                    <li>修复并发布热更</li>
                </ul>
            </div>

            <!-- Comments Stream -->
            <div class="comments-section">
                <div class="section-title">评论 (3)</div>
                <div class="comment-list" id="commentList">
                    <!-- Comments will be rendered by JS -->
                </div>
            </div>
        </div>



        <!-- Status Modal -->
        <div class="modal-overlay" id="statusModal" style="display: none;">
            <div class="modal-content tech-panel">
                <div class="modal-header">
                    <h3>更改状态</h3>
                    <button class="close-modal-btn" id="closeStatusModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="action-list">
                    <div class="action-item" onclick="updateStatus('To Do')">
                        <i class="ri-checkbox-blank-circle-line"></i> 待办
                    </div>
                    <div class="action-item" onclick="updateStatus('In Progress')">
                        <i class="ri-loader-2-line"></i> 进行中
                    </div>
                    <div class="action-item" onclick="updateStatus('Done')">
                        <i class="ri-checkbox-circle-line"></i> 已完成
                    </div>
                </div>
            </div>
        </div>

        <!-- Date Modal -->
        <div class="modal-overlay" id="dateModal" style="display: none;">
            <div class="modal-content tech-panel">
                <div class="modal-header">
                    <h3>设置截止日期</h3>
                    <button class="close-modal-btn" id="closeDateModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="date-options-grid"
                    style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 16px;">
                    <button class="tech-btn" onclick="updateDate('今天')">今天</button>
                    <button class="tech-btn" onclick="updateDate('明天')">明天</button>
                    <button class="tech-btn" onclick="updateDate('下周')">下周</button>
                </div>
                <input type="date" class="tech-input"
                    style="width: 100%; padding: 12px; background: var(--bg-panel); border: 1px solid var(--border-dim); color: var(--text-primary); border-radius: 8px;">
            </div>
        </div>

        <!-- More Actions Modal -->
        <div class="modal-overlay" id="moreActionsModal" style="display: none;">
            <div class="modal-content tech-panel">
                <div class="modal-header">
                    <h3>更多操作</h3>
                    <button class="close-modal-btn" id="closeMoreModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="action-list">
                    <div class="action-item" data-action="delete" style="color: #FF0055; border-color: #FF0055;">
                        <i class="ri-delete-bin-line" style="color: #FF0055;"></i>
                        <span>删除任务</span>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End app-container -->

    <!-- HUD Cockpit Container -->
    <div class="hud-container-fixed">
        <div class="bottom-hud hud-collapsed" id="bottomHud">
            <!-- Manual Toggle Button -->
            <div class="hud-toggle-btn" id="hudToggleBtn">
                <i class="ri-arrow-down-s-line"></i>
            </div>

            <div class="hud-expanded-content">
                <!-- Row 1: Properties (Collapsible) -->
                <div class="hud-row properties-row">
                    <div class="hud-pill status-pill" id="statusPill">
                        <i class="ri-loader-2-line"></i>
                        <span id="statusText">进行中</span>
                    </div>
                    <div class="hud-pill" id="assigneePill">
                        <i class="ri-user-3-line"></i>
                        <span>Felix</span>
                    </div>
                    <div class="hud-pill" id="datePill">
                        <i class="ri-calendar-event-line"></i>
                        <span id="dateText">今天</span>
                    </div>
                </div>

                <!-- Row 2: Actions (Collapsible) -->
                <div class="hud-row actions-row">
                    <button class="hud-icon-btn" id="openNotionBtn" title="Open in Notion">
                        <i class="ri-notion-fill"></i>
                    </button>
                    <button class="hud-icon-btn" id="jumpBtn" title="Jump to Chat">
                        <i class="ri-share-forward-line"></i>
                    </button>
                    <button class="hud-icon-btn" title="Contact Creator">
                        <i class="ri-user-voice-line"></i>
                    </button>
                    <button class="hud-icon-btn" id="moreBtn" title="More">
                        <i class="ri-more-2-fill"></i>
                    </button>
                </div>
            </div>

            <!-- Row 3: Input (Always Visible) -->
            <div class="hud-row input-row">
                <div class="hud-input-wrapper">
                    <input type="text" placeholder="发送评论..." id="commentInput">
                    <button class="hud-send-btn"><i class="ri-send-plane-fill"></i></button>
                </div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>

</html>