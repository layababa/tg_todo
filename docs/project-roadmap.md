# Telegram To-Do Mini App Â· é˜¶æ®µè§„åˆ’åœ°å›¾ï¼ˆé•¿æœŸç‰ˆï¼‰

> ä¾æ® `docs/prd/prd.md`ã€`docs/frontend/frontend_requirements.md`ã€`docs/server/backend-development-plan.md` ä¸ã€Šå½“å‰å·¥ä½œæ—¥å¿—.mdã€‹æ•´ç†ï¼Œä½œä¸ºé•¿æœŸå‚ç…§ã€‚æ­¤æ–‡æ¡£ä¸€æ—¦ç”Ÿæˆä»…åœ¨éœ€æ±‚ç¡®å®å˜æ›´æ—¶æ›´æ–°ï¼Œè¯·å‹¿åœ¨æ—¥å¸¸å·¥ä½œæ—¥å¿—ä¸­è¦†ç›–æœ¬è§„åˆ’ã€‚

## é˜¶æ®µ 0 Â· åŸºç¡€è®¾æ–½ & èº«ä»½ï¼ˆæ¨¡å— 1-2 Â· âœ… 2025-12-05 å‰å®Œæˆï¼‰

- **ç›®æ ‡**ï¼šæä¾›å¯è¿è¡Œçš„åç«¯ä¸ Onboarding èƒ½åŠ›ï¼Œæ”¯æ’‘åç»­æ‰€æœ‰æ¨¡å—ã€‚
- **äº¤ä»˜**ï¼š
  - `cmd/api` å¯åŠ¨ä½“ã€é…ç½®åŠ è½½ã€DB/Redis è¿æ¥ã€`/healthz`ã€ç»Ÿä¸€ä¸­é—´ä»¶ã€‚
  - Telegram init data é‰´æƒã€User/NotionToken æ¨¡å‹ã€AES-256-GCM å·¥å…·ã€Notion OAuthã€`/auth/*`ã€‚
  - å‰ç«¯ Onboardingï¼ˆVue + Pinia + DaisyUIï¼‰å¯¹æ¥ `/auth/status`ã€`/auth/notion/url`ï¼Œæ”¯æŒ start_param ä¸æ¸¸å®¢æ¨¡å¼ã€‚
- **éªŒæ”¶**ï¼š`CGO_ENABLED=0 go test ./...` å…¨ç»¿ï¼›`curl /healthz` è¿”å›ç‰ˆæœ¬/git hash/ä¾èµ–ï¼›é¦–æ¬¡è®¿é—® `/auth/status` è‡ªåŠ¨å»ºç”¨æˆ·å¹¶è¿”å› `notion_connected`ï¼Œå›è°ƒå¯æŒä¹…åŒ– Notion tokenã€‚
- **å½’æ¡£**ï¼šè¯¦è§ `docs/server/backend-progress-2025-12-05.md`ã€‚

## é˜¶æ®µ 1 Â· Bot å…¥å£ä¸ Update å»é‡ï¼ˆæ¨¡å— 3 Â· âœ… 2025-12-05 å®Œæˆï¼‰

- **ç›®æ ‡**ï¼šå¯é æ¥å…¥ Telegram Webhook/é•¿è½®è¯¢ï¼Œå…·å¤‡å¹‚ç­‰ä¸å®¡è®¡ï¼Œä½œä¸ºä»»åŠ¡åˆ›å»ºçš„å…¥å£ã€‚
- **åŠŸèƒ½**ï¼š
  - `/webhook/telegram` æ ¡éªŒ `X-Telegram-Bot-Api-Secret-Token`ï¼Œè¯»å– bodyã€æå– `update_id`ï¼ŒRedis `SETNX` å¹‚ç­‰ï¼Œå†™å…¥ `telegram_updates` è¡¨ã€‚
  - è®°å½• `payload_type`ã€`chat_id`ã€my_chat_member äº‹ä»¶ï¼Œç”Ÿæˆå®¡è®¡æ—¥å¿—/è¡¨ã€‚
  - è§£æåŸºç¡€å‘½ä»¤ `/start`ï¼ˆè¿”å› Mini App æ·±é“¾ï¼‰ã€`/help`ï¼ˆèƒ½åŠ›è¯´æ˜ï¼‰ï¼›æ— æ•ˆè¯·æ±‚å¿«é€Ÿè¿”å›ã€‚
- **éªŒæ”¶**ï¼š
  - Webhook å¹³å‡å»¶è¿Ÿ <500msï¼Œé‡å¤ `update_id` ä¸äº§ç”Ÿå‰¯ä½œç”¨ã€‚
  - my_chat_member å¯å†™å…¥ç¾¤çŠ¶æ€å®¡è®¡ï¼›å‘½ä»¤è¯·æ±‚è¿”å›å›ºå®šæ–‡æ¡ˆã€‚
  - Postgres `telegram_updates` ä»…æ’å…¥ä¸€æ¬¡ï¼ŒRedis æ—¥å¿—å« `duplicate` æ ‡è®°ã€‚

## é˜¶æ®µ 2 Â· ä»»åŠ¡åˆ›å»º & Deep Linkï¼ˆæ¨¡å— 4-5 Â· âœ… 2025-12-08 å®Œæˆï¼‰

- **ç›®æ ‡**ï¼šè¦†ç›– PRD S1/S2/S7 åœºæ™¯ï¼Œè®© Reply/Forward/@Bot å¯ç›´æ¥åˆ›å»ºä»»åŠ¡ï¼Œå¹¶æ”¯æŒæ·±é“¾è·³è½¬ã€‚
- **åŠŸèƒ½**ï¼š
  - è§£æ reply/forward/@Bot æ¶ˆæ¯ï¼ŒæŠ½å–æ ‡é¢˜ã€æŒ‡æ´¾äººã€æ“ä½œè€…ï¼›æŠ“å– 10 æ¡ä¸Šä¸‹æ–‡å­˜ `task_context_snapshots`ã€‚
  - æ”¯æŒå¤šäºº @ æŒ‡æ´¾ï¼›æœªå¯åŠ¨ Bot çš„æˆå‘˜åœ¨ç¾¤å†…æç¤ºã€‚
  - æœªç»‘å®š Notion çš„ç”¨æˆ·/ç¾¤ï¼šä»»åŠ¡å†™æœ¬åœ° DBï¼Œ`sync_status=Pending`ï¼›Forward åˆ°ç§èŠå†™ä¸ªäººé»˜è®¤åº“/æç¤ºç»‘å®šã€‚
  - ç”Ÿæˆ `task_{id}` deep linkï¼Œå¹¶å®ç° `/bootstrap` API + Mini App start_param è·¯ç”±ã€‚
- **éªŒæ”¶**ï¼š
  - ç»‘å®šç¾¤å†… Reply + @Bot â†’ `tasks`, `task_context_snapshots`, `task_assignees` æ­£ç¡®å†™å…¥ï¼›ç¾¤å†…å›æ‰§å« deep link + jumpã€‚
  - æœªç»‘å®š Notion æ—¶ä»»åŠ¡ä»å¯åˆ›å»ºï¼Œåˆ—è¡¨æ ‡è®° Pendingã€‚
  - start*param `task*{id}`/`group\_{id}`/`settings` èƒ½åœ¨å‰ç«¯è·¯ç”±è½åœ°ï¼›é€šçŸ¥/Deep link ç‚¹å‡»ç›´è¾¾è¯¦æƒ…æˆ–åŸæ¶ˆæ¯ã€‚

## é˜¶æ®µ 3 Â· Notion èµ„æº & ç¾¤ç»„ç»‘å®šï¼ˆæ¨¡å— 6-8 Â· ğŸ”„ æ¨¡å— 6 å®Œæˆï¼‰

- **ç›®æ ‡**ï¼šå®Œæˆ Notion token ç”Ÿå‘½å‘¨æœŸã€æ•°æ®åº“åˆ—è¡¨/æ ¡éªŒ/åˆå§‹åŒ–ï¼Œä»¥åŠç¾¤ç»‘å®šçŠ¶æ€æœºï¼Œä¿éšœä»»åŠ¡å†™å…¥ Notionã€‚
- **åŠŸèƒ½**ï¼š
  - Token è‡ªåŠ¨åˆ·æ–°ã€workspace ç¼“å­˜ã€å¤±æ•ˆæé†’ï¼›`/auth/status` æ­£ç¡®åæ˜  `notion_connected`ã€‚
  - `GET /databases` åˆ—å‡ºæˆæƒåº“ã€åˆ†é¡µ/æœç´¢ï¼›`validate` æ£€æµ‹ç¼ºå­—æ®µï¼›`init` è‡ªåŠ¨åˆ›å»ºå­—æ®µã€‚
  - ç¾¤ç®¡ç† APIï¼šåˆ—è¡¨ã€ç»‘å®š/è§£ç»‘ã€æ›´æ¢åº“ã€åˆ·æ–°ç®¡ç†å‘˜ä¸çŠ¶æ€ï¼›è®°å½• message_thread_idã€‚
- **éªŒæ”¶**ï¼š
  - Token è¿‡æœŸè‡ªåŠ¨åˆ·æ–°ï¼Œå¤±è´¥æœ‰é€€é¿/å‘Šè­¦ã€‚
  - åº“æ ¡éªŒå¯æç¤ºç¼ºå­—æ®µï¼Œåˆå§‹åŒ–åŠ¨ä½œèƒ½è‡ªåŠ¨è¡¥é½ï¼›é™æµ/æƒé™é”™è¯¯è¿”å›æ˜ç¡® codeã€‚
  - ç»‘å®šæµç¨‹ï¼šéç®¡ç†å‘˜ç¦æ­¢ï¼›è¢«è¸¢å‡ºç¾¤æ ‡è®° Inactive å¹¶æé†’ï¼›æˆåŠŸåç¾¤/ç®¡ç†åå°åŒæ­¥çŠ¶æ€ã€‚

## é˜¶æ®µ 4 Â· ä»»åŠ¡å·¥ä½œå°ï¼ˆæ¨¡å— 9-11ï¼‰

- **ç›®æ ‡**ï¼šå®ç°ä»»åŠ¡æ ¸å¿ƒ CRUDã€æŒ‡æ´¾/çŠ¶æ€/æˆªæ­¢ã€è¯„è®ºæ ‘ï¼Œæ»¡è¶³ Mini App åˆ—è¡¨ä¸è¯¦æƒ…é¡µã€‚
- **åŠŸèƒ½**ï¼š
  - `GET /tasks` æ”¯æŒ view=assigned/created/allã€db_id è¿‡æ»¤ã€åˆ†é¡µã€ç©ºçŠ¶æ€ï¼›`GET /tasks/{id}` è¿”å›ä¸Šä¸‹æ–‡ã€deep linkã€Notion Page IDã€‚
  - `PATCH /tasks/{id}`ï¼ˆçŠ¶æ€/æŒ‡æ´¾/æˆªæ­¢/æ ‡é¢˜/æè¿°ï¼‰ä¸ `DELETE` è½¯åˆ ï¼›æƒé™ï¼šAdmin/åˆ›å»ºäºº/æŒ‡æ´¾äººã€‚
  - è¯„è®ºï¼š`GET/POST /tasks/{id}/comments`ï¼Œæ”¯æŒåµŒå¥—ã€æ¥æºæ ‡è®°ã€Notion åŒå†™ä¸è¡¥å¿é˜Ÿåˆ—ã€‚
- **éªŒæ”¶**ï¼š
  - åˆ—è¡¨æ€§èƒ½ç¬¦åˆé¢„æœŸï¼ˆç¼“å­˜å¯é€‰ï¼‰ï¼›è¯¦æƒ…å«ä¸Šä¸‹æ–‡ä¸è·³è½¬ï¼›çŠ¶æ€æµè½¬å¹‚ç­‰ä¸”è§¦å‘é€šçŸ¥ã€‚
  - å¤šäººæŒ‡æ´¾ã€æˆªæ­¢æ—¶é—´æ—¶åŒºå¤„ç†æ­£ç¡®ï¼›æ— æƒé™è¿”å› 403ã€‚
  - è¯„è®ºæ ‘ç»“æ„ä¸åŸå‹ä¸€è‡´ï¼›Notion å†™å…¥å¤±è´¥è¿›å…¥è¡¥å¿é˜Ÿåˆ—ã€‚

## é˜¶æ®µ 5 Â· é€šçŸ¥ä½“ç³» & Notion åŒæ­¥ï¼ˆæ¨¡å— 12-13ï¼‰

- **ç›®æ ‡**ï¼šæä¾›ç¨³å®šçš„é€šçŸ¥ä¸åŒå‘åŒæ­¥ï¼Œæ‰“é€š Notion â†” Telegramã€‚
- **åŠŸèƒ½**ï¼š
  - é€šçŸ¥æ¨¡æ¿ï¼ˆä»»åŠ¡åˆ›å»º/æŒ‡æ´¾/çŠ¶æ€/è¯„è®º/åˆ é™¤/æŒ‡æ´¾å¤±è´¥ï¼‰ï¼Œæ“ä½œè€…å»é‡ã€Block æ ‡è®°ã€Redis å¹‚ç­‰é”®ã€æ·±é“¾æŒ‰é’®ã€‚
  - Notion è½®è¯¢/å›è°ƒï¼Œå¤„ç†çŠ¶æ€/è¯„è®º/æ–°å¢åŒæ­¥ï¼›429/403/404 é€€é¿ï¼›åº“ç¼ºå¤±å‘Šè­¦ï¼›`/tasks/sync` å°† Pending æ‰¹é‡å†™å…¥ Notionã€‚
- **éªŒæ”¶**ï¼š
  - é€šçŸ¥åªæ¨é€ç»™ç›¸å…³æˆå‘˜ï¼Œæ“ä½œè€…ä¸é‡å¤ï¼›`notifications` è®°å½•é€è¾¾å’Œé‡è¯•ï¼›Block ç”¨æˆ·æ ‡è®°ä¸å¯è¾¾ã€‚
  - Notion æ›´æ–°åœ¨ 2 åˆ†é’Ÿå†…åæ˜ åˆ° Telegramï¼›å¼‚å¸¸æœ‰é€€é¿ä¸å‘Šè­¦ï¼›Pending åŒæ­¥ API å¯æ¸…ç†å†å²ä»»åŠ¡ã€‚

## é˜¶æ®µ 6 Â· Digest & ä¸ªäººè®¾ç½®ï¼ˆæ¨¡å— 14-15ï¼‰

- **ç›®æ ‡**ï¼šæä¾›æ¯æ—¥æ‘˜è¦æ¨é€å’Œä¸ªäººé»˜è®¤æ•°æ®åº“/æ—¶åŒºè®¾ç½®ï¼Œå®Œå–„ç”¨æˆ·ä½“éªŒã€‚
- **åŠŸèƒ½**ï¼š
  - æŒ‰ç”¨æˆ·æ—¶åŒºå®šæ—¶ç”Ÿæˆä»Šæ—¥æˆªæ­¢/é€¾æœŸ/å¾…åŠæ‘˜è¦ï¼Œå¯å…³é—­ã€é‡å‘ï¼›åˆ©ç”¨é€šçŸ¥æ·±é“¾è·³è½¬ã€‚
  - `/me` è¯»å–æ¦‚è¦ï¼›`/me/settings` æ›´æ–° default_db_id/timezoneï¼›Forward ä»»åŠ¡ä½¿ç”¨é»˜è®¤åº“ï¼›`/auth/logout` æ³¨é”€æ¸…ç†ä¼šè¯ã€‚
- **éªŒæ”¶**ï¼š
  - Digest å‡†æ—¶æ¨é€å¹¶è½é€šçŸ¥è¡¨ï¼›å…³é—­åä¸å†æ¨é€ã€‚
  - è®¾ç½®æ¥å£å¹‚ç­‰ï¼›æ›´æ–°é»˜è®¤åº“å Forward ä»»åŠ¡èµ°æ–°åº“ï¼›æ³¨é”€å token æ¸…ç†ã€‚

## é˜¶æ®µ 7 Â· å¯è§‚æµ‹æ€§ & è¿ç»´ï¼ˆæ¨¡å— 16ï¼‰

- **ç›®æ ‡**ï¼šå®Œå–„ç›‘æ§ã€æ—¥å¿—ã€traceã€CI/CD ä¸è¿ç»´æ–‡æ¡£ï¼Œç¡®ä¿ä¸Šçº¿å¯è§‚æµ‹ã€‚
- **åŠŸèƒ½**ï¼š
  - Prometheus metricsï¼ˆAPI å»¶è¿Ÿ/é”™è¯¯ç‡ã€Notion æˆåŠŸç‡ã€é˜Ÿåˆ—ç§¯å‹ï¼‰ã€ç»“æ„åŒ–æ—¥å¿—ã€request-id è´¯ç©¿ã€trace é›†æˆï¼›SLO å‘Šè­¦ã€‚
  - CI æµç¨‹ï¼ˆlint/test/buildï¼‰ã€éƒ¨ç½²è„šæœ¬ã€Cloudflare Tunnel/Compose æ–‡æ¡£ã€å‘Šè­¦ç­–ç•¥ã€‚
- **éªŒæ”¶**ï¼š
  - Metrics/æ—¥å¿—/trace å¯å…³è”è¯·æ±‚ï¼›SLOï¼ˆé‰´æƒå¤±è´¥ç‡ã€Notion 429/403/404ã€é˜Ÿåˆ—ç§¯å‹ï¼‰è¶Šç•Œè§¦å‘å‘Šè­¦ã€‚
  - ä¸»å¹² CI é»˜è®¤æ‰§è¡Œæµ‹è¯•ä¸æ„å»ºï¼›`docs/deploy/*` è¦†ç›– Tunnelã€Composeã€ç¯å¢ƒå˜é‡æ¨¡æ¿ã€‚

---

**ä½¿ç”¨æ–¹å¼**

- è¯¥è§„åˆ’ä¸ºé•¿æœŸè“å›¾ï¼›é˜¶æ®µå®Œæˆåï¼Œå°†æˆæœä¸éªŒæ”¶ç»“è®ºå½’æ¡£åˆ°å¯¹åº” `docs/server/backend-progress-*.md`ï¼ŒåŒæ—¶åœ¨ã€Šå½“å‰å·¥ä½œæ—¥å¿—.mdã€‹æ›´æ–°å®æ—¶çŠ¶æ€ã€‚
- è‹¥ PRD/FRD å‘ç”Ÿæ ¹æœ¬æ€§è°ƒæ•´ï¼Œéœ€åœ¨æ›´æ–°æœ¬æ–‡ä»¶å‰å…ˆç»ç”±äº§å“ç¡®è®¤å¹¶è®°å½•åœ¨ `å½“å‰å·¥ä½œæ—¥å¿—.md` çš„â€œå¾…ç¡®è®¤â€åŒºåŸŸã€‚
