# 🧠 需求草案: AI 辅助任务上下文分析 (AI Context Analysis)

> **Status**: 📥 Pending (Backlog)
> **Date**: 2025-12-27
> **Priority**: Medium (To be assessed)
> **Author**: AI Agent

## 1. 背景与目标 (Context & Goal)

当前用户在 Telegram 群聊中创建任务时，往往只输入简短的指令（如 `@Bot fix bug`）。虽然系统已支持抓取前 10 条消息作为上下文，但这些信息未被充分利用，导致：

1.  **优先级缺失**：所有新任务默认为无优先级或同一优先级，需人工二次调整。
2.  **描述匮乏**：任务标题简略，执行者需阅读大量上下文才能理解背景。

本需求旨在利用 LLM (AI) 能力，自动分析上下文，智能填充任务属性，降低人工维护成本。

## 2. 核心需求 (Functional Requirements)

### 2.1 AI 智能定级 (Smart Priority)

- **输入**：用户创建任务时的触发消息 + 前 10 条群聊历史消息。
- **逻辑**：AI 根据聊天语境、关键词（如"紧急"、"立刻"、"Bug"、"线上故障"）及语气情感进行判断。
- **输出**：`High` / `Medium` / `Low`。
- **默认策略**：若上下文中无明确紧急暗示，默认定级为 **Medium**（或根据现有业务规则兜底）。

### 2.2 AI 智能概述 (Smart Summary)

- **逻辑**：AI 阅读上下文后，生成一段简短的背景/行动摘要。
- **写入位置**：**追加**到任务的 `Description` 字段中。
  - _注意_：不修改用户输入的原始 `Title`，而是作为补充信息。
- **格式**：纯文本，建议控制在 100 字以内，清晰陈述"要做什么"及"背景是什么"。

## 3. 交互与性能 (UX & Non-functional)

### 3.1 静默处理 (Silent Processing)

- AI 分析过程对用户**不可见**，不阻塞任务创建的主流程。
- 用户发送指令 -> 任务立即创建成功（基础数据入库） -> Bot 回复确认。

### 3.2 异步更新 (Async Update)

- **机制**：任务创建后，后台异步触发 AI 分析任务。
- **延迟容忍**：允许有数秒至数十秒的延迟。
- **结果回写**：AI 分析完成后，系统自动更新该任务的 Priority 和 Description 字段。
- **通知**：更新过程**不**触发新的打扰（如弹窗或额外通知），仅在用户后续查看详情时呈现。

## 4. 待确认项 (Open Questions)

- [ ] 是否需要支持用户在设置中开启/关闭此功能？
- [ ] LLM 的 Token 消耗与成本控制策略？
- [ ] 极端情况（如包含敏感信息）的脱敏处理？
